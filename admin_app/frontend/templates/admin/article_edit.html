{% extends 'admin/base.html' %}

{% block title %}Edit Article: {{ article.title | e }} â€” Admin Panel{% endblock %}

{% block content %}
<h1>Edit Article: {{ article.title | e }}</h1>

{% if error %}
    <div class="flash flash-error">{{ error }}</div>
{% endif %}
{% if success %}
    <div class="flash flash-success">{{ success }}</div>
{% endif %}

{# Hidden file input for image uploads #}
<input type="file" id="image-upload-input" accept="image/*" style="display: none;">

{# Form points to the new POST endpoint #}
<form method="post" action="/admin/articles/{{ article.id }}/edit" id="article-form">
    <div style="margin-bottom: 1rem;">
        <label for="title">Title:</label><br>
        {# Pre-fill value #}
        <input type="text" id="title" name="title" value="{{ article.title | e }}" required style="width: 100%; padding: 0.5rem;">
    </div>
    <div style="margin-bottom: 1rem;">
        <label for="slug">Slug:</label><br>
        {# Pre-fill value #}
        <input type="text" id="slug" name="slug" value="{{ article.slug | e }}" required style="width: 100%; padding: 0.5rem;">
    </div>
    <div style="margin-bottom: 1rem;">
        <label for="editor">Content (Markdown):</label><br>
        {# Tiptap Toolbar #}
        <div id="tiptap-toolbar" style="border: 1px solid #ccc; border-bottom: none; padding: 5px; background-color: #f8f8f8;">
            <button type="button" id="toolbar-bold">B</button>
            <button type="button" id="toolbar-italic">I</button>
            <button type="button" id="toolbar-underline">U</button>
            <button type="button" id="toolbar-strike">S</button>
            <span class="toolbar-divider">|</span>
            <button type="button" id="toolbar-h1">H1</button>
            <button type="button" id="toolbar-h2">H2</button>
            <button type="button" id="toolbar-h3">H3</button>
            <button type="button" id="toolbar-p">P</button>
            <span class="toolbar-divider">|</span>
            <button type="button" id="toolbar-ul">UL</button>
            <button type="button" id="toolbar-ol">OL</button>
            <button type="button" id="toolbar-task">Task</button>
            <button type="button" id="toolbar-blockquote">Quote</button>
            <span class="toolbar-divider">|</span>
            <button type="button" id="toolbar-link">Link</button>
            <button type="button" id="toolbar-image">Image</button>
            <button type="button" id="toolbar-table">Table</button>
            <button type="button" id="toolbar-code">Code</button>
            <button type="button" id="toolbar-codeblock">CodeBlock</button>
            <span class="toolbar-divider">|</span>
            <button type="button" id="toolbar-hr">HR</button>
            <button type="button" id="toolbar-undo">Undo</button>
            <button type="button" id="toolbar-redo">Redo</button>
            {# Add more buttons as needed: highlight, color, text-align, sub/sup, font-family, etc. #}
        </div>
        {# Div for Tiptap Editor #}
        <div id="editor" style="border: 1px solid #ccc; border-radius: 0 0 5px 5px; min-height: 300px; background-color: #fff; padding: 10px;"></div>
        {# Hidden input to store the final Markdown content #}
        <input type="hidden" id="content_md_hidden" name="content_md">
        {# Hidden textarea to pass initial markdown to Tiptap JS #}
        <textarea id="initial_markdown" style="display: none;">{{ article.content_md | e }}</textarea>
    </div>
    <div style="margin-bottom: 1rem;">
        <label for="status">Status:</label><br>
        <select id="status" name="status" style="width: 100%; padding: 0.5rem;">
            {# Pre-select the current status #}
            <option value="draft" {% if article.status == 'draft' %}selected{% endif %}>Draft</option>
            <option value="published" {% if article.status == 'published' %}selected{% endif %}>Published</option>
        </select>
    </div>
    <button type="submit" class="btn">Update Article</button>
    <a href="/admin/articles/{{ article.id }}" style="margin-left: 1rem;">Cancel</a>
</form>
{# Tiptap initialization is handled by the script loaded via vite_tags #}
{% endblock %} 